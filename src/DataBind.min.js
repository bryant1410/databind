"use strict";(function(e){if(typeof define==="function"&&define.amd){define(e)}else{window.DataBind=e()}})(function(){function s(e){return e&&window.jQuery&&e instanceof window.jQuery}function o(e){if(s(e))return e[0];return e}function u(e,t){if(!e)return undefined;var n=t!==undefined;if(["checkbox","radio"].indexOf(e.type)>=0){if(n){e.checked=!!t}return e.checked}if(["text","textarea","select-one","email","url","week","time","search","tel","range","number","month","datetime-local","date","color","password"].indexOf(e.type)>=0){if(n){e.value=t}return e.value}if(["select-multiple"].indexOf(e.type)>=0){if(n){if(!a(t)){t=[t]}}var r=[];var i=e&&e.options;var s;for(var o=0,u=i.length;o<u;o++){s=i[o];if(n){if(t.indexOf(s.value)>-1){s.selected=true}else{s.selected=false}}if(s.selected){r.push(s.value||s.text)}}return r}if(n){e.innerText=t}return e.innerText}function a(e){return Object.prototype.toString.call(e)==="[object Array]"}function f(e){if(["checkbox","radio","select-one","select-multiple","password"].indexOf(e.type)>=0){return"change"}if(["text","textarea"].indexOf(e.type)>=0){return"input"}}function l(e){if(!e.hashkey){e.hashkey=Date.now()+Math.floor(Math.random()*1e5)}return e.hashkey}function c(e,n){if(!e||!n)return;var r=l(e);t[r]=t[r]||[];if(t[r].indexOf(n)>-1)return;t[r].push(n);var i=f(e);e.addEventListener(i,n,false)}function h(e,n){var r=l(e);var i=t[r].indexOf(n);if(!t[r]||i===-1)return;t[r].splice(i,1);var s=f(e);e.removeEventListener(s,n,false)}function p(e){var n=l(e);var r=t[n];if(!e||!r)return;var i=r.concat();var s,o=i.length;for(s=0;s<o;s++){h(e,i[s])}}function d(e,t){var n=t.split(".");var r=e;var i;for(i=0;i<n.length;i++){if(!r.hasOwnProperty(n[i]))return false;r=r[n[i]]}return true}function v(e,t){var n=t.split(".");var r=e;var i;for(i=0;i<n.length-1;i++){r=r[n[i]]}return r}function m(e,t,n){var r=t.split(".");var i=v(e,t);if(n!==undefined){i[r[r.length-1]]=n}return i[r[r.length-1]]}function g(e,t,n){var i=function(e,t,n,r,i,s,o,u){return function(e){var a=i(this);var f=s(this);var l=r(t,n);r(t,n,a);o(u,this,{key:f,oldValue:l,newValue:a})}}(e,t,n,m,u,E,k,r);c(e,i)}function y(e){p(e)}function b(t,r,i){var s=function(e,t,n,r,i,s,o){return function(t,n,u,a){var t=s(e);r(e,u);i(o,e,{key:t,oldValue:a,newValue:u})}}(t,r,i,u,k,E,n);e.watch(r,i,s)}function w(t,n){var r=t.watchers[n];var i;for(i=0;i<r.length;i++){e.unwatch(t,n,r[i])}}function E(e){if(!e)return;return e.getAttribute(i)}function S(e){e=e||{};e={dom:e.dom!==undefined?e.dom:true,model:e.model!==undefined?e.model:true,children:e.children!==undefined?e.children:true};return e}function x(e,t){if(!e||!t)return{};var n=E(e);if(!n)return{};var r=d(t,n);var i=v(t,n);var s=n.split(".");s=s[s.length-1];return{key:n,deepKey:s,deepModel:i,keyExists:r}}function T(e,t,n){if(!e||!t)return false;var r=x(e,t);if(!r.keyExists)return false;var i=m(t,r.key);u(e,i);if(n.dom){g(e,r.deepModel,r.deepKey)}if(n.model){b(e,r.deepModel,r.deepKey)}return true}function N(e,t,n){if(!e||!t)return;var r=x(e,t);if(!r.keyExists)return;if(n.dom){y(e)}if(n.model){w(r.deepModel,r.deepKey)}}function C(e,t){var n=[e],r,i;if(t.children){r=e.getElementsByTagName("*");for(i=0;i<r.length;i++){n.push(r[i])}}return n}function k(e,t,n){var r=document.createEvent("Events");r.initEvent(e,true,true);r.data=n;t.dispatchEvent(r)}function L(e,t,i,s){function u(e,n){o.push(n);if(s.dom){e.addEventListener(i,n,false)}if(s.model){e.addEventListener(t,n,false)}}function a(e,t){var i=o.indexOf(t);if(i===-1)return;o.splice(i,1);if(s.dom){e.removeEventListener(r,t,false)}if(s.model){e.removeEventListener(n,t,false)}}function f(e){var t,n=o.concat();for(t=0;t<n.length;t++){a(e,n[t])}}function l(t){var n;for(n=0;n<e.length;n++){u(e[n],t)}}function c(t){var n,r=a;if(t===undefined){r=f}for(n=0;n<e.length;n++){r(e[n],t)}}var o=[];return{watch:l,unwatch:c}}function A(e,t,i){if(!e||!t)return;var s=o(e);if(s!==e){arguments[0]=s;return A.apply(this,arguments)}i=S(i);var u=C(e,i);var a;var f,l=[];for(a=0;a<u.length;a++){f=T(u[a],t,{dom:i.dom,model:i.model});if(f){l.push(u[a])}}var c=new L(l,n,r,i);e.watchable=c;return c}function O(e,t,n){if(!e||!t)return;var r=o(e);if(r!==e){arguments[0]=r;return O.apply(this,arguments)}n=S(n);var i=C(e,n);var s;for(s=0;s<i.length;s++){N(i[s],t,{dom:n.dom,model:n.model})}e.watchable.unwatch()}var e=function(){var e={noMore:false},t=[];var n=function(e){var t={};return e&&t.toString.call(e)=="[object Function]"};var r=function(e){return e%1===0};var i=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var s=function(e,t){var n=[],r=[];if(!(typeof e=="string")&&!(typeof t=="string")&&!i(e)&&!i(t)){for(var s in e){if(!t[s]){n.push(s)}}for(var o in t){if(!e[o]){r.push(o)}}}return{added:n,removed:r}};var o=function(e){if(null==e||"object"!=typeof e){return e}var t=e.constructor();for(var n in e){t[n]=e[n]}return t};var u=function(e,t,n,r){try{Object.defineProperty(e,t,{get:n,set:r,enumerable:true,configurable:true})}catch(i){try{Object.prototype.__defineGetter__.call(e,t,n);Object.prototype.__defineSetter__.call(e,t,r)}catch(s){throw"watchJS error: browser not supported :/"}}};var a=function(e,t,n){try{Object.defineProperty(e,t,{enumerable:false,configurable:true,writable:false,value:n})}catch(r){e[t]=n}};var f=function(){if(n(arguments[1])){l.apply(this,arguments)}else if(i(arguments[1])){c.apply(this,arguments)}else{h.apply(this,arguments)}};var l=function(e,t,n,r){if(typeof e=="string"||!(e instanceof Object)&&!i(e)){return}var s=[];if(i(e)){for(var o=0;o<e.length;o++){s.push(o)}}else{for(var u in e){s.push(u)}}c(e,s,t,n,r)};var c=function(e,t,n,r,s){if(typeof e=="string"||!(e instanceof Object)&&!i(e)){return}for(var o in t){h(e,t[o],n,r,s)}};var h=function(e,t,r,s,o){if(typeof e=="string"||!(e instanceof Object)&&!i(e)){return}if(n(e[t])){return}if(e[t]!=null&&(s===undefined||s>0)){if(s!==undefined){s--}l(e[t],r,s)}m(e,t,r);if(o){x(e,t,r,s)}};var p=function(){if(n(arguments[1])){d.apply(this,arguments)}else if(i(arguments[1])){v.apply(this,arguments)}else{E.apply(this,arguments)}};var d=function(e,t){if(e instanceof String||!(e instanceof Object)&&!i(e)){return}var n=[];if(i(e)){for(var r=0;r<e.length;r++){n.push(r)}}else{for(var s in e){n.push(s)}}v(e,n,t)};var v=function(e,t,n){for(var r in t){E(e,t[r],n)}};var m=function(t,n,r){var i=t[n];w(t,n);if(!t.watchers){a(t,"watchers",{})}if(!t.watchers[n]){t.watchers[n]=[]}for(var s in t.watchers[n]){if(t.watchers[n][s]===r){return}}t.watchers[n].push(r);var o=function(){return i};var f=function(s){var o=i;i=s;if(t[n]){l(t[n],r)}w(t,n);if(!e.noMore){if(JSON.stringify(o)!==JSON.stringify(s)){g(t,n,"set",s,o);e.noMore=false}}};u(t,n,o,f)};var g=function(e,t,n,i,s){for(var o in e.watchers[t]){if(r(o)){e.watchers[t][o].call(e,t,n,i,s)}}};var y=["pop","push","reverse","shift","sort","slice","unshift"];var b=function(e,t,n,r){a(e[t],r,function(){var i=n.apply(e[t],arguments);h(e,e[t]);if(r!=="slice"){g(e,t,r,arguments)}return i})};var w=function(e,t){if(!e[t]||e[t]instanceof String||!i(e[t])){return}for(var n=y.length,r;n--;){r=y[n];b(e,t,e[t][r],r)}};var E=function(e,t,n){for(var r in e.watchers[t]){var i=e.watchers[t][r];if(i==n){e.watchers[t].splice(r,1)}}T(e,t,n)};var S=function(){for(var e in t){var n=t[e];var r=s(n.obj[n.prop],n.actual);if(r.added.length||r.removed.length){if(r.added.length){for(var i in n.obj.watchers[n.prop]){c(n.obj[n.prop],r.added,n.obj.watchers[n.prop][i],n.level-1,true)}}g(n.obj,n.prop,"differentattr",r,n.actual)}n.actual=o(n.obj[n.prop])}};var x=function(e,n,r,i){t.push({obj:e,prop:n,actual:o(e[n]),watcher:r,level:i})};var T=function(e,n,r){for(var i in t){var s=t[i];if(s.obj==e&&s.prop==n&&s.watcher==r){t.splice(i,1)}}};setInterval(S,50);e.watch=f;e.unwatch=p;e.callWatchers=g;return e}();var t={};var n="databind-model-change";var r="databind-dom-change";var i="data-key";return{bind:A,unbind:O}})